<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>test001</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="../assets/css/myStyle.css" />
    <script src="../js/jquery3.3.1.js"></script>
    <style>
      button {
        margin: 5px;
      }
    </style>
  </head>
  <body>
    <!--
      <div id="myMaskDiv">
        <img src="/assets/image/lg.circle-slack-loading-icon.gif" />
      </div>
    -->

    <div class="container">
      <div class="row">
        <div class="col-md" style="background:pink; height: 0.5cm;">
          <!-- One of three columns -->
        </div>
        <div class="col-md" style="background:lightseagreen;">
          <!-- One of three columns -->
        </div>
        <div class="col-md" style="background:lightskyblue;">
          <!-- One of three columns -->
        </div>
      </div>
    </div>

    <div class="container">
      <div class="row">
        <div class="col-md">
          <!-- One of three columns -->
          <button type="button" class="btn btn-danger" onclick="alert('幹你娘')">點我</button>
          <button id="btnMask" class="btn btn-primary" type="button">發送請求(and Mask Page)</button>
        </div>
        <div class="col-md"><!-- One of three columns --></div>
        <div class="col-md"><!-- One of three columns --></div>
      </div>
    </div>

    <div class="container">
      <div class="row">
        <table id="myTable" class="table table-sm table-hover" border="2">
          <thead>
            <tr class="table-primary">
              <th scope="col">#</th>
              <th scope="col">CityId</th>
              <th scope="col">CityName</th>
              <th scope="col">鄉鎮數</th>
            </tr>
          </thead>
          <tbody>
              <!-- dynamic generate -->
          </tbody>
        </table>
      </div>
    </div>

    <script>
      $(function() {
        //alert(123);

        $("#btnMask").click((e) => {
            e.preventDefault();
            $.ajax({
                type: "GET",
                url: "https://works.ioa.tw/weather/api/all.json",
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                success: function(cbData) {
                // console.log(cbData);

                var frag = $(document.createDocumentFragment())
                $.each(cbData, (idx, elem) => {
                    console.log(idx, elem);
                    let td1 = $('<td/>').append(idx);
                    let td2 = $('<td/>').append(elem.id);
                    let td3 = $('<td/>').append(elem.name);
                    let td4 = $('<td/>').append(elem.towns.length);
                    let myTr = $('<tr/>').append(td1).append(td2).append(td3).append(td4)
                    frag.append(myTr);
                });
                $('#myTable').append(frag);
                
                }
            });
        });

        /*************************************************
         * jQuery.ajaxSetup() 方法设置全局 AJAX 默认选项。
         *
         * 【我直接改寫在 jquery.js檔案末端了 】
         *************************************************/
        // $.ajaxSetup({
        //   global: false, // 是否触发全局 AJAX 事件。默认值: true。设置为 false 将不会触发全局 AJAX 事件
        //   type: "POST",
        //   async: true, // 默认值: true。默认设置下，所有请求均为异步请求。
        //   beforeSend: function(XMLHttpRequest) {
        //     // $("#myMaskDiv").show();
        //     var myMaskImgTag = $('<img></img>').prop('src', "/assets/image/lg.circle-slack-loading-icon.gif");
        // 	$('<div id="myMaskDiv"></div>').append(myMaskImgTag).appendTo('body').show();
        //   },
        //   complete: function(XMLHttpRequest, textStatus) {
        //     $("#myMaskDiv").hide();
        //   },
        //   error: function(jqXHR, exception) {
        //     var msg = "";
        //     if (jqXHR.status === 0) {
        //       msg = "Not connect.\n Verify Network.";
        //     } else if (jqXHR.status == 404) {
        //       msg = "Requested page not found. [404]";
        //     } else if (jqXHR.status == 500) {
        //       msg = "Internal Server Error [500].";
        //     } else if (exception === "parsererror") {
        //       msg = "Requested JSON parse failed.";
        //     } else if (exception === "timeout") {
        //       msg = "Time out error.";
        //     } else if (exception === "abort") {
        //       msg = "Ajax request aborted.";
        //     } else {
        //       msg = "Uncaught Error.\n" + jqXHR.responseText;
        //     }
        //     console.log('%c%s', 'color: red' , exception);
        //     alert(mag);
        //   }
        // });
      });
    </script>
  </body>
</html>
